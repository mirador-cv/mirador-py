{"name":"Mirador-py","tagline":"A python client for the mirador (http://mirador.im) API","body":"# Mirador-Py [![Build Status](https://drone.io/github.com/mirador-cv/mirador-py/status.png)](https://drone.io/github.com/mirador-cv/mirador-py/latest)\r\n\r\nA python client for the Mirador [Image Moderation API](http://mirador.im). To get started, you will need an API Key, available at [mirador.im](http://mirador.im). For questions about keys or support with this module please email support@mirador.im.\r\n\r\n## Installation\r\n\r\nThe module is available [on pypi](https://pypi.python.org/pypi/Mirador), and can be installed with pip:\r\n\r\n```shell\r\npip install mirador\r\n```\r\n\r\n## Getting started: command-line tool\r\n\r\nThere's a command-line tool included in, which should show up as `mirador-client` in your `PATH`. It takes in a file(s) of ids and urls and outputs html showing the result:\r\n\r\n```shell\r\necho \"baby-1  http://demo.mirador.im/test/baby.jpg\" > test.urls\r\nmirador-client -k your_api_key test.urls > test.html\r\nopen test.html\r\n```\r\n## Classifying Files\r\n\r\nThe python client supports working with a number of data types:\r\n\r\n* file objects (e.g, `x` where `x = open('myfile.png', 'r')`) [classify_files](#classify_files)\r\n* filenames [classify_files](#classify_files)\r\n* data uris (e.g., data:image/png;base64,eehlk3jr;q3lfhf;eaef==) [classify_data_uris](#classify_data_uris)\r\n* file buffers (e.g., `x` where `x` = open('myfile.png', 'r').read()`) -- useful for form uploads [classify_buffers](#classify_buffers)\r\n\r\nEvery method has an associated single-request method, e.g., [classify_file](#classify_file) for classify_files. These have a similar interface but only support processing of one item at a time.\r\n\r\n### <a name='classify_files'></a> mirador.MiradorClient#classify_files\r\n\r\nAll classification methods share an identical interface that allows for generally flexible input. The mirador API, and the `mirador.MiradorResultList` object returned by the API allow for the attribution of an arbitrary identifier to your requests, to make post-processing of results easier. However, in cases where you do not specify an ID, the client will choose one (in a way that generally makes sense). For more information on the format of results, please see the documentation on [mirador.MiradorResultList](#result-list).\r\n\r\nThe simplest way to classify files is by filename:\r\n\r\n```python\r\nimport mirador\r\n\r\nclient = mirador.MiradorClient('your_api_key')\r\nresults = client.classify_files('nsfw.jpg', 'sfw.jpg')\r\n\r\n# since no id was specified, the requests are given the filenames as ids:\r\nprint results['nsfw.jpg'].safe \r\nprint results['sfw.jpg'].safe\r\n```\r\n\r\nAlternatively, you can specify an id by passing in a dictionary of id: item mappings, or by using kwargs (as in a `dict()` constructor):\r\n\r\n```python\r\n# these are equivalent\r\nresults = client.classify_files({'nsfw': 'nsfw.jpg', 'sfw': 'sfw.jpg'})\r\nresults = client.classify_files(nsfw='nsfw.jpg', sfw='sfw.jpg')\r\n```\r\n\r\n#### <a name='using-file-objects'></a> Using File Objects\r\n\r\nYou can also pass file or file-like objects (that have a `read()` method and `.name` property, e.g., a `BytesIO`) using either format:\r\n\r\n```python\r\n# the id will be item.name, so in this case, the filenames will be the ids\r\nresults = client.classify_files(open('nsfw.jpg', 'r'), open('sfw.jpg', 'r'))\r\n\r\n# same request, specifying ids\r\nresults= client.classify_files(nsfw=open('nsfw.jpg', 'r'), sfw=open('sfw.jpg', 'r'))\r\n```\r\n\r\nTo pass an already-read file (a buffer), use [classify_buffers](#classify_buffers)\r\n\r\n#### <a name='classify_file'></a> mirador.MiradorClient#classify_file\r\n\r\nAs in the other classification methods, classify_files has a corresponding single-request method, classify_file. This can be used with the same interface as its multiple-request sibling:\r\n\r\n```python\r\nnsfw = client.classify_file('nsfw.jpg')\r\nprint nsfw.id # \"nsfw.jpg\"\r\n\r\nnsfw = client.classify_file({'nsfw': 'nsfw.jpg'})\r\nprint nsfw.id # 'nsfw'\r\n\r\nnsfw = client.classify_file(nsfw='nsfw.jpg')\r\nprint nsfw.id # 'nsfw'\r\n```\r\n\r\n### <a name='classify_buffers'></a> mirador.MiradorClient#classify_buffers\r\n\r\nThis has an identical usage/interface to [classify_files](#classify_files), except that instead of passing in filenames or file objects, you only provide already-read buffers.\r\n\r\nWhen not explicitly specifying an ID, the client uses the index of the item in the parameters, since we can't derive a name from a file buffer:\r\n\r\n```python\r\nimport mirador\r\n\r\nclient = mirador.MiradorClient('your_api_key')\r\n\r\nresponses = client.classify_buffers(open('nsfw.jpg', 'r').read(), open('sfw.jpg', 'r').read())\r\nprint responses[0].safe # False\r\nprint responses[1].safe # True\r\n```\r\n\r\nFor this reason, when working with buffers, it's best to specify an id (if you can):\r\n\r\n```python\r\nimport mirador\r\n\r\nclient = mirador.MiradorClient('your_api_key')\r\n\r\nresponses = client.classify_buffers(nsfw=open('nsfw.jpg', 'r').read(), sfw=open('sfw.jpg', 'r').read())\r\n\r\nprint responses['nsfw'].value # 0.99\r\nprint responses['sfw'].safe # True\r\n```\r\n\r\n#### <a name='classify_buffer'></a> mirador.MiradorClient#classify_buffer\r\n\r\nThis is a simple helper when only classifying one buffer, it returns a `mirador.MiradorResult` object directly, instead of a `mirador.MiradorResultList`. The interface is otherwise identical to classify_buffers:\r\n\r\n```python\r\nnsfw_result = client.classify_buffer(open('nsfw.jpg', 'r').read())\r\nnsfw_result = client.classify_buffer(nsfw=open('nsfw.jpg', 'r').read())\r\n```\r\n\r\n### <a name='classify_data_uris'><a> mirador.MiradorClient#classify_data_uris\r\n\r\nThis method exists as a convenience for simplified client-server communication when using clients that work with data uris (e.g., in web applications). For example, given this javascript (using jQuery to be concise):\r\n\r\n```javascript\r\n\r\n$('#form-field').on('change', function (e) {\r\n  var file = this.files[0],\r\n      reader = new FileReader();\r\n\r\n  reader.onload = function (e) {\r\n    $.post('/proxy/mirador', { id: file.name, data: e.target.result }).done(function (res) {\r\n      console.log(res);\r\n    });\r\n  };\r\n\r\n  reader.readAsDataURL(file);\r\n});\r\n```\r\n\r\nWe could handle that request on the server with this code:\r\n\r\n```python\r\nimport mirador\r\nfrom flask import Flask, jsonify\r\n\r\napp = Flask(__name__)\r\nmc = mirador.MiradorClient('your_api_key')\r\n\r\n@app.route('/proxy/mirador', methods=('POST',))\r\ndef proxy_image():\r\n\r\n  id = request.form['id']\r\n  data = request.form['data']\r\n\r\n  return jsonify(\r\n      **client.classify_data_uri(id=data).__dict__))\r\n\r\n\r\nif __name__ == '__main__':\r\n    app.run()\r\n\r\n```\r\n\r\nThis example shows the singular, `classify_data_uri`, however, the multiple -- `classify_data_uris`, has an identical interface.\r\n\r\n\r\n## <a name='classifying-urls'></a> Classifying Urls\r\n\r\nThere are a couple of requirements to be mindful of when classifying urls, they must meet the following criteria:\r\n\r\n* be publically-accessibly\r\n* have a correctly set mimetype (`image/*`)\r\n* respond/be retrievable in less than `mirador.MiradorClient.TIMEOUT` seconds\r\n* not require query paramters\r\n\r\nGiven that, the interface for classifying urls is identical to that when using [classify_files](#classify_files)\r\n\r\n### <a name='classify_urls'></a> mirador.MiradorClient#classify_urls\r\n\r\nSince urls are text and are generally short, our client uses the url as an id by default:\r\n\r\n```python\r\nimport mirador\r\n\r\nclient = mirador.MiradorClient('your_api_key')\r\n\r\nresults = client.classify_urls('http://static.mirador.im/test/nsfw.jpg', 'http://static.mirador.im/test/sfw.jpg')\r\nprint results['http://static.mirador.im/test/nsfw.jpg']\r\n\r\n```\r\n\r\nHowever, as with classifying files, an id can be specified either through keyword arguments or a dictionary:\r\n\r\n```python\r\n\r\n# these are equivalent\r\nresults = client.classify_urls(nsfw='http://static.mirador.im/test/nsfw.jpg', sfw='http://static.mirador.im/test/sfw.jpg')\r\nprint results['nsfw']\r\n\r\nresults = client.classify_urls({'nsfw': 'http://static.mirador.im/test/nsfw.jpg', 'sfw': 'http://static.mirador.im/test/sfw.jpg'})\r\nprint results['nsfw']\r\n\r\n```\r\n\r\n#### <a name='classify_url'></a> mirador.MiradorClient#classify_url\r\n\r\nAs with the other methods/data types, you can also classify a single url using the convenience function `classify_url`. This will return a mirador.MiradorResult object:\r\n\r\n```python\r\nnsfw_result = client.classify_url('http://static.mirador.im/test/nsfw.jpg')\r\n\r\nnsfw_result = client.classify_url(nsfw='http://static.mirador.im/test/nsfw.jpg')\r\nprint nsfw_result.id # \"nsfw\"\r\n```\r\n\r\n## <a name='result'></a> mirador.MiradorResult\r\n\r\nThe `MiradorResult` object reprents the classification result for a single image/url. It has the following properties:\r\n\r\n* `id` `[string|int]` - a unique identifier for the result\r\n* `safe` `[boolean]` - indicates if an image contains adult content.\r\n* `value` `[float 0.0-1.0]` - the likelyhood that the image does contain adult content (for implementing a custom threshold)\r\n* `name` `[string]` **DEPRECATED** - maps to `id`\r\n\r\nThis object contains a helper `to_json` method, along with `__str__` and `__repr__` overrides that provide easy visual access to information about the result.\r\n\r\n## <a name='result-list'></a> mirador.MiradorResultList\r\n\r\nThe purpose of the result list (over a built-in `list`) is to allow for indexing by a Result's `id`, which can be achieved through regular bracket syntax. You can iterate the `MiradorResultList` object as a `dict`:\r\n\r\n```python\r\n\r\nresults = client.classify_files('test1.jpg', 'test2.jpg')\r\nresults['test1.jpg'] # MiradorResult\r\n\r\nfor id, result in results:\r\n    print \"{}, {}\".format(id, type(result)) # test1.jpg, MiradorResult\r\n\r\n```\r\n\r\nThe `MiradorResultList` object also has a `__len__` override so you can easily check how many results you have received.\r\n\r\n## Contributing / Issues\r\n\r\nPlease submit any issues as issues [here on github](http://github.com/mirador-cv/mirador-py/issues), feel free to submit a pull request, or for immediate support, contact us at support@mirador.im.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}